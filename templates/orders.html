{% extends 'base.html' %}
{% block content %}
<h2>Заказы</h2>
<a class="btn btn-sm btn-success mb-3" href="{{ url_for('import_orders') }}">Импорт заказов</a>
<table class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>№</th>
            <th>Клиент</th>
            <th>Телефон</th>
            <th>Адрес</th>
            <th>Статус</th>
            <th>Координаты</th>
            <th>Зона доставки</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for o in orders %}
        <tr>
            <td>{{ o.id }}</td>
            <td>{{ o.order_number }}</td>
            <td>{{ o.client_name }}</td>
            <td>{{ o.phone }}</td>
            <td>{{ o.address }}</td>
            <td>
                <form method="post" class="d-flex">
                    <input type="hidden" name="id" value="{{ o.id }}">
                    <select name="status" class="form-select form-select-sm me-2">
                        {% for st in ['Складская обработка','В пути','Доставлен'] %}
                        <option value="{{ st }}" {% if o.status==st %}selected{% endif %}>{{ st }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-sm btn-primary">OK</button>
                </form>
            </td>
            <td>{% if o.latitude and o.longitude %}✔{% else %}✘{% endif %}</td>
            <td>{{ o.zone or '—' }}</td>
            <td>
                <button class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#editModal{{ o.id }}">Редактировать</button>
                <div class="modal fade" id="editModal{{ o.id }}" tabindex="-1" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <form method="post" action="{{ url_for('update_order', order_id=o.id) }}">
                        <div class="modal-header">
                          <h5 class="modal-title">Редактирование заказа {{ o.order_number }}</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <div class="mb-3">
                            <label class="form-label">Имя клиента</label>
                            <input type="text" class="form-control" name="client_name" value="{{ o.client_name }}">
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Телефон</label>
                            <input type="text" class="form-control" name="phone" value="{{ o.phone }}">
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Адрес</label>
                            <input type="text" class="form-control" name="address" value="{{ o.address }}">
                          </div>
                          <div class="mb-3">
                            <label class="form-label">Заметка</label>
                            <textarea class="form-control" name="note">{{ o.note or '' }}</textarea>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                          <button type="submit" class="btn btn-primary">Сохранить</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
